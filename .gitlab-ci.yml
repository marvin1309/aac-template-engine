# You can override the included template(s) by including variable overrides
# SAST customization: https://docs.gitlab.com/ee/user/application_security/sast/#customizing-the-sast-settings
# Secret Detection customization: https://docs.gitlab.com/ee/user/application_security/secret_detection/pipeline/#customization
# Dependency Scanning customization: https://docs.gitlab.com/ee/user/application_security/dependency_scanning/#customizing-the-dependency-scanning-settings
# Container Scanning customization: https://docs.gitlab.com/ee/user/application_security/container_scanning/#customizing-the-container-scanning-settings
# Note that environment variables can be set in several places
# See https://docs.gitlab.com/ee/ci/variables/#cicd-variable-precedence
stages:
- collect
- parse
- render
- commit


#ollect_services:
# stage: collect
# image: alpine:latest
# tags: [docker]
# before_script:
#   - apk add --no-cache curl bash jq
#   - wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
#   - chmod +x /usr/local/bin/yq
# script:
#   - bash .gitlab-ci/scripts/shell/generate-services.yml.sh
# artifacts:
#   paths:
#     - .gitlab-ci/services.yml
#   expire_in: 1h
#
#arse_services:
# stage: parse
# image: python:3.10
# tags: [docker]
# dependencies:
#   - collect_services
# before_script:
#   - pip install --user --quiet jinja-cli.yml]
#   - export PATH="$PATH:$HOME/.local/bin"
# script:
#   - python3 .gitlab-ci/scripts/python/render-services.py
# artifacts:
#   paths:
#     - "*/*/compose/"
#   expire_in: 1h
#
#ommit_all_services:
# stage: commit
# image: alpine:latest
# tags: [docker]
# needs:
#   - job: parse_services
#     artifacts: true
# before_script:
#   - apk add --no-cache git
#   - git config user.name "CI Bot"
#   - git config user.email "ci@example.com"
# script:
#   - git add */*/compose || echo "Nothing to add"
#   - git commit -m "ðŸš€ Auto-render all services [ci skip]" || echo "Nothing to commit"
#   - git push "https://oauth2:${CI_GITLAB_TOKEN}@${CI_SERVER_HOST}/${CI_PROJECT_PATH}.git" HEAD:main
# rules:
#   - if: '$CI_COMMIT_BRANCH == "main"'
#     when: on_success
#